/*!
 * Copyright 2011~2012, ICAT JavaScript Library v1.1.3
 * https://github.com/valleykid/icat
 *
 * Copyright (c) 2012 valleykid
 * Licensed under the MIT license.
 *
 * @Author valleykiddy@gmail.com
 * @Time 2012-11-29 19:52:00
 */
(function(){var b=this,a={};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=a}exports.ICAT=a}else{b.ICAT=a}var g=navigator.userAgent,c=Object.prototype,e=c.toString,d=Array.isArray,f=["namespace"];a.mix=function(m,l,o,k){if(!l||!m){return m}if(!k){k=true}var j,n,h;if(o&&(h=o.length)){for(j=0;j<h;j++){n=o[j];if(n in l){if(k||!(n in m)){m[n]=l[n]}}}}else{for(n in l){if(k||!(n in m)){m[n]=l[n]}}}return m};a.mix(a,{version:"1.1.3",isDebug:/debug/i.test(b.location.href),browser:{safari:/webkit/i.test(g),opera:/opera/i.test(g),msie:/msie/i.test(g)&&!/opera/i.test(g),mozilla:/mozilla/i.test(g)&&!/(compatible|webkit)/i.test(g)},isFunction:function(h){return e.call(h)=="[object Function]"},isString:function(h){return e.call(h)=="[object String]"},isArray:d||function(h){return e.call(h)=="[object Array]"},isObject:function(h){return e.call(h)=="[object Object]"},isNull:function(h){return h===null},foreach:function(p,h,l){var k,m=0,n=p.length,j=n===undefined||a.isString(p);if(l){if(j){for(k in p){if(h.apply(p[k],l)===false){break}}}else{for(;m<n;){if(h.apply(p[m++],l)===false){break}}}}else{if(j){for(k in p){if(h.call(p[k],k,p[k])===false){break}}}else{for(;m<n;){if(h.call(p[m],m,p[m++])===false){break}}}}},Class:function(){var j=arguments,h=j.length;if(h==0){return null}else{if(h==1){var i=j[0];if(!a.isObject(i)){return null}else{function l(){i.Create.apply(this,arguments)}a.foreach(i,function(o,n){if(o!="Create"){l.prototype[o]=n}});return l}}else{if(h>=2){var m=j[0],i=j[1],k=j[2]||b;if(!a.isString(m)||!a.isObject(i)){return null}else{function l(){i.Create.apply(this,arguments)}a.foreach(i,function(o,n){if(o!="Create"){l.prototype[o]=n}});k[m]=l}}}}},widget:function(i,h){this.Class(i,h,a)},namespace:function(){var k=arguments,h=k.length,r=null,n,m,q;for(n=0;n<h;++n){q=(""+k[n]).split(".");r=this;for(m=(b[q[0]]===r)?1:0;m<q.length;++m){r=r[q[m]]=r[q[m]]||{}}}return r},app:function(i,l){var h=this,j=h.isString(i),k=j?b[i]||{}:i;h.mix(k,h,f,true);h.mix(k,h.isFunction(l)?l():l);j&&(b[i]=k);return k},log:function(h){b.console!==undefined&&console.log?console.log(h):alert(h)}})}).call(this);(function(e){var v=document,p=v.head||v.getElementsByTagName("head")[0],s=v.getElementsByName("appRef")[0],l,b,o,f,c,g,t,a,u,j,n,d,m={},r={};(function(w){l=w[w.length-1];b=l.hasAttribute?l.src:l.getAttribute("src",4);u=l.getAttribute("corelib")||"";j=l.getAttribute("asyn-corelib")||"";n=l.getAttribute("main")||"";d=l.getAttribute("asyn-main")||"";f=/\/sys\//i.test(b);c=/^\.{2}\//.test(n||d);if(/\?[vt]=\d+/.test(b)){o=b.replace(/.*\?/,"?");b=b.replace(/\?.*/,"")}})(v.getElementsByTagName("script"));e.modsConfig={};e.sysRef=f?b.replace(/\/sys\/.*/,"/sys"):b.replace(/\/\w*\.js/,"");e.appRef=s?s.content:e.sysRef;e.libRef=e.sysRef+"/lib";a=s?s.getAttribute("corecss"):"";g=f?b.replace(/icat\..*/,"plugin/"):e.sysRef+"plugin/";t=e.appRef+(c?"/assets":"")+"/plugin/";e.config=function(w){e.modsConfig[w.modName]=[];e.foreach(w.paths,function(y,x){e.modsConfig[w.modName].push((w.baseUrl||"")+x)})};var i=function(A){if(!A){return}var y=A.replace(/\s|[\?#].*/g,""),z=y.replace(/.*\./g,""),w=z=="css";if(!y){return}if(e.isDebug){y=/\.source/i.test(y)?y:(w?y.replace(/\.css/g,".source.css"):y.replace(/\.js/g,".source.js"))}if(/^(http|ftp|https):\/\/.*/i.test(y)){return y}else{if(/^\.(\.|~)?\//g.test(y)){if(/^\.\//.test(y)){y=y.replace(/^\./,e.appRef)}if(/^\.{2}\//.test(y)){y=y.replace(/^\.{2}/,e.appRef+(w?"/assets/css":"/assets/js"))}if(/^\.~\//.test(y)){y=y.replace(/^\.~\//,t)}}else{if(/^\/{1,2}/.test(y)){if(/^\/{2}/.test(y)){var x=y.replace(/^\/{2}|.source|.css|.js/ig,"");x=/\d|\./.test(x)?x.replace(/\d(\/)?|\./g,""):x;y=y.replace(/^\//,e.libRef+"/"+x)}else{y=y.replace(/^\//,e.libRef+"/")}}else{if(/^~\//.test(y)){y=y.replace(/^~\//,g)}else{y=e.sysRef+"/"+y}}}}return y+(o||"")},k=function(D){var z=D,A=z.replace(/[\?#].*/,"");if(m[A]){return}var B=A.replace(/.*\./g,""),y=B=="css",x=y?"link":"script",w=y?' type="text/css" rel="stylesheet"':' type="text/javascript"',C=(y?"href":"src")+'="'+z+'"';v.write("<"+x+w+C+(y?"/>":"></"+x+">"));m[A]=true},h=function(z,w,y,x){if(w&&e.isFunction(w)){w(x||e)}if(y){r[y]=true;e.modsConfig[y]=e.modsConfig[y]?e.modsConfig[y]:[];e.modsConfig[y].push(z)}},q=function(A,F,D,y){var w=A,E=l.parentNode||p,B=w.replace(/[\?#].*/,"");if(m[B]){h(A,F,D,y);return}var z,C=B.replace(/.*\./g,"");if(C==="css"){z=v.createElement("link");z.setAttribute("type","text/css");z.setAttribute("rel","stylesheet");z.setAttribute("href",w)}else{if(C==="js"){z=v.createElement("script");z.setAttribute("type","text/javascript");z.setAttribute("src",w);z.setAttribute("async",true)}}if(!z){return}if(e.browser.msie){var x=setInterval(function(){try{document.documentElement.doScroll("left")}catch(G){return}clearInterval(x);if(C==="js"&&z.readyState){z.onreadystatechange=function(){if(z.readyState=="loaded"||z.readyState=="complete"){z.onreadystatechange=null;h(A,F,D,y);m[B]=true}}}E.appendChild(z)},1)}else{if(C==="js"){z.onload=function(){h(A,F,D,y);m[B]=true}}E.appendChild(z)}if(C==="css"){setTimeout(function(){h(A,F,D,y)},5);m[B]=true;E.appendChild(z)}};e.mix(e,{inc:function(w){if(!w){return}w=e.isString(w)?[w]:w;e.foreach(w,function(y,x){if(!x){return}k(i(x))})},incfile:function(D,y,C,B,A){if(!D){return}D=e.isString(D)?[D]:D;var x=D.length-1;if(C){var z=0,w=function(){if(z<x){q(i(D[z]),function(){w()},undefined,A)}else{q(i(D[x]),y,undefined,A)}z++};w()}else{e.foreach(D,function(F,E){F==x?q(i(E),y,undefined,A):q(i(E),undefined,undefined,A)})}},require:function(z,D,y,C,B){if(!D){return}D=e.isString(D)?[D]:D;if(r[z]){if(y){y(B)}}else{var x=D.length-1,A=0,w=function(){if(A<x){q(i(D[A]),function(){w()},z,B)}else{q(i(D[x]),y,z,B)}A++};w()}},use:function(x,w,A,z){var y=0,A=A||500,B;if(r[x]){if(w){w(z)}}else{if(e.modsConfig[x]){B=setInterval(function(){y+=5;if(r[x]){clearInterval(B);if(w){w(z)}}else{if(y>=A){clearInterval(B);e.require(x,e.modsConfig[x],w,z)}}},5)}}}});if(a){e.inc(a)}if(u){u=u.split(",");e.inc(u)}else{if(j){j=j.split(",");e.incfile(j,undefined,true)}}if(n){e.inc(n)}else{if(d){e.incfile(d)}}})(ICAT);
